<form [formGroup]="formNotificationInfo" (submit)="createNotification()"  class="col-12" >

  <mat-card >

    <mat-card-header>

      <mat-card-title>
        <span *ngIf=" !businessNotification">Create notification for your business</span>
        <span *ngIf="businessNotification">Update notification for your business</span>

      </mat-card-title>

    </mat-card-header>
    <mat-divider></mat-divider>
    <mat-card-content class="p-3">

      <div class="row">

        <p>Select a business for which you are creating the notification</p>
        <div class="col-md-12">

          <mat-form-field appearance="outline" >
            <mat-error>Please select a business</mat-error>
            <mat-label>Select Business</mat-label>
            <mat-select formControlName="listing_id" >
              <mat-select-trigger>

                    <span *ngIf="formNotificationInfo.controls.listing_id.value">
                     <i class="fa fa-check-circle text-success"></i>&nbsp;{{formNotificationInfo.controls.listing_id.value.business_name_prefix}} {{formNotificationInfo.controls.listing_id.value.business_name}}
                    </span>

              </mat-select-trigger>
              <mat-option>
                <ngx-mat-select-search formControlName="search_business"
                                       placeholderLabel="Search ..."
                                       noEntriesFoundLabel="'no match found'"></ngx-mat-select-search>
              </mat-option>

              <mat-option [value]="business" *ngFor="let business of businesses | searchBusiness : formNotificationInfo.controls.search_business.value">{{business.business_name_prefix}} {{business.business_name}}</mat-option>
            </mat-select>
          </mat-form-field>

        </div>
        <a class="text-primary text-right" [routerLink]="['/'+routes.business.create]"><i>Don't have a business listed yet ? Create business</i></a>

      </div>


      <div class="row" >

        <mat-label>Notification title</mat-label>

        <div class="col-md-12">

          <mat-form-field    appearance="outline">
            <input formControlName="name"  name="title" matInput>
            <mat-error>What is notification title</mat-error>

          </mat-form-field>


        </div>
      </div>

      <div class="row mt-3">

        <mat-label matTooltip="Write about the notification">Description</mat-label>


        <div class="col-md-12">

          <mat-error *ngIf="formNotificationInfo.controls.description.touched && formNotificationInfo.controls.description.invalid ">Description is required</mat-error>

          <ckeditor formControlName="description" name="description" [editor]="Editor"  data=""></ckeditor>



        </div>

      </div>
      <div class="row mt-2" *ngIf="images.length > 0">

        <mat-label class="mb-2">Saved Images</mat-label>
        <div class="col-md-3 mb-4 text-center" *ngFor="let img of images">

          <div style="width: 100%;height: 100px;background: url('{{img}}');background-position: center center; background-size:cover;border-radius:10px;margin-bottom:15px;">

          </div>

          <button class="btn btn-danger btn-block btn-sm" type="button" (click)="deleteImage(img)">
            <i class="fa fa-trash"></i>
          </button>

        </div>

      </div>
      <div class="row mt-2">

        <div class="col-md-12">
          <mat-label class="mb-2">Images</mat-label>
          <div class="col-md-12">
            <ngx-dropzone (change)="onSelect($event)">
              <ngx-dropzone-label>Drop files here or click to upload</ngx-dropzone-label>

              <ngx-dropzone-image-preview  [file]="f" *ngFor="let f of files" [removable]="true" (removed)="onRemove(f)">
                <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
              </ngx-dropzone-image-preview>


            </ngx-dropzone>

          </div>



        </div>




      </div>
      <div class="row mt-3" *ngIf="fileProgress === true">

        <p class="text-primary">Images uploading on progress ...</p>
        <mat-divider></mat-divider>
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>

      </div>


    </mat-card-content>
    <mat-divider></mat-divider>
    <mat-card-actions class="text-center">

      <div class="row">

        <div class="col-md-12 mt-2 mb-2 text-center" *ngIf="notificationSaveProgress === true">
          <p class="text-success mb-2">
            Saving Notification ...
          </p>
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </div>

        <div class="col-md-6">

        </div>
        <div class="col-md-6">
          <button *ngIf="notificationSaveProgress === false"  class="next-btn" mat-raised-button color="primary">
            Submit
          </button>
        </div>

      </div>




    </mat-card-actions>


  </mat-card>

</form>
