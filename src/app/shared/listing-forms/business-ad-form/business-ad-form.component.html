<form [formGroup]="formAdInfo" (submit)="createAd()"  class="col-12" >

  <app-my-stepper *ngIf="!businessAd" class="d-block d-md-none mt-4 pt-5" [steps]="steps" [activeStep]="activeStep"></app-my-stepper>


  <app-mobile-header-with-back-button [zIndex]="100003"  (onBackPressed)="activeStep = -1" *ngIf="activeStep !== -1 && businessAd" [heading]="heading" [urlAction]="false"></app-mobile-header-with-back-button>

  <div class="w-100  d-block d-md-none" id="promotion-form-mobile">

    <div class="col-md-12 p-0 pt-4 pb-3" *ngIf="activeStep === -1">

      <ng-container *ngIf="businessAd.gallery && businessAd.gallery.length;">
        <div class="w-100">
          <img src="{{businessAd.gallery[0].img}}" class="img-fluid">
        </div>
      </ng-container>
<!--      <ng-template #businessGallery>-->
<!--        <div class="w-100" *ngIf="promotion.business && promotion.business.gallery && promotion.business.gallery.length">-->
<!--          <img src="{{promotion.business.gallery[0].img}}" class="img-fluid">-->
<!--        </div>-->
<!--      </ng-template>-->

      <div class="w-100 py-3">

        <div matRipple (click)="goStep(0)" class="my-accordion w-100 px-2 py-2 d-flex justify-content-between align-items-center">
          <span>{{"General"}}</span>
          <span class="material-symbols-outlined">
arrow_forward_ios
</span>
        </div>
        <mat-divider></mat-divider>

        <div matRipple (click)="goStep(1)" class="my-accordion w-100 px-2 py-2 d-flex justify-content-between align-items-center">
          <span>{{"Description"}}</span>
          <span class="material-symbols-outlined">
arrow_forward_ios
</span>
        </div>

        <mat-divider></mat-divider>

        <div matRipple (click)="goStep(2)" class="my-accordion w-100 px-2 py-2 d-flex justify-content-between align-items-center">
          <span>{{"Gallery"}}</span>
          <span class="material-symbols-outlined">
arrow_forward_ios
</span>
        </div>

        <mat-divider></mat-divider>


      </div>

    </div>

    <div class="w-100 pt-4">

      <div class="col-md-12" *ngIf="activeStep === 0">
        <mat-error *ngIf="formAdInfo.controls.business_id.touched && formAdInfo.controls.business_id.invalid">{{'Please select a business' | translate}}</mat-error>

        <mat-form-field appearance="outline">
          <mat-label>{{'Select Business' | translate}}</mat-label>
          <mat-select formControlName="business_id">
            <mat-select-trigger>

                    <span *ngIf="formAdInfo.controls.business_id.value">
                     <i class="fa fa-check-circle text-success"></i>&nbsp;{{formAdInfo.controls.business_id.value.business_name_prefix}} {{formAdInfo.controls.business_id.value.business_name}}
                    </span>

            </mat-select-trigger>
            <mat-option>
              <ngx-mat-select-search formControlName="search_business"
                                     placeholderLabel="{{'Search' | translate}} ..."
                                     noEntriesFoundLabel="'no match found'"></ngx-mat-select-search>
            </mat-option>

            <mat-option [value]="business"
                        *ngFor="let business of businesses | searchBusiness : formAdInfo.controls.search_business.value">{{business.business_name_prefix}} {{business.business_name}}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-error *ngIf="formAdInfo.controls.title.touched && formAdInfo.controls.title.invalid">{{'What is ad title' | translate}}</mat-error>

        <mat-form-field appearance="outline">
          <mat-label>{{'Ad Title' | translate}}</mat-label>

          <input formControlName="title" name="ad_title" matInput>

        </mat-form-field>

        <mat-error *ngIf="formAdInfo.controls.date.touched && formAdInfo.controls.date.invalid">{{'When will the ad start ?' | translate}}</mat-error>

        <mat-form-field  appearance="outline">
          <mat-label>{{'Announcement Date' | translate}}</mat-label>
          <input matInput type="date" name="date" formControlName="date" >
        </mat-form-field>


        <div class="col-md-12">

          <mat-error *ngIf="formAdInfo.controls.status.touched && ! formAdInfo.controls.status.value">{{'Please specify' | translate}} </mat-error>

          <mat-slide-toggle formControlName="status"  name="status">{{'Enable / Disable Status' | translate}}</mat-slide-toggle>

        </div>


      </div>

      <div class="col-md-12" *ngIf="activeStep === 1">

        <mat-error *ngIf="formAdInfo.controls.description.touched && formAdInfo.controls.description.invalid ">
                    Description is required
                  </mat-error>
        <mat-form-field appearance="outline">
          <mat-label>{{"Description" | translate}}</mat-label>

          <textarea
                  formControlName="description"
                  matInput
                  rows="5"
              ></textarea>

        </mat-form-field>

      </div>

      <div class="col-md-12" *ngIf="activeStep === 2">

        <app-file-uploader [multipleUpload]="true" (uploading)="buttonDisabled = $event" (dataChanged)="images = $event" [label]="'Upload Gallery Images'" [images]="images"></app-file-uploader>


      </div>

    </div>

    <div class="col-12 d-flex mt-4" *ngIf="activeStep !== -1">

      <ng-container *ngIf="!businessAd">
        <div *ngIf="activeStep > 0" class="w-50 pe-1">
          <button type="button" (click)="prevStep()" class="btn btn-theme-dark btn-block">
            {{"BACK"}}
          </button>
        </div>
        <div [ngClass]="{'w-100' : activeStep < 1 , 'w-50 ps-1' : activeStep > 0}">
          <button [disabled]="buttonDisabled" type="button" (click)="nextStep()" class="btn btn-theme-dark btn-block">
            <ng-container *ngIf="activeStep < 3"> {{"NEXT"}} </ng-container>
            <ng-container *ngIf="activeStep >= 3"> {{"SUBMIT"}} </ng-container>
          </button>
        </div>
      </ng-container>

      <ng-container *ngIf="businessAd">
        <div *ngIf="activeStep !== -1" class="w-100">
          <button [disabled]="buttonDisabled" type="button" (click)="save()" class="btn btn-theme-dark btn-block">
            {{"Save"}}
          </button>
        </div>
      </ng-container>

    </div>

    <app-progress-bar *ngIf="AdSaveProgress"></app-progress-bar>


  </div>



  <mat-card class="d-none d-md-block" >

    <mat-card-header>

      <mat-card-title>{{'Business Ad Information' | translate}}</mat-card-title>

    </mat-card-header>
    <mat-divider></mat-divider>
    <mat-card-content class="p-3">

      <div class="row">

        <p>{{'Select a business for which you are creating the ad' | translate}}</p>
        <div class="col-md-12">

          <mat-form-field appearance="outline" >
            <mat-error>{{'Please select a business' | translate}}</mat-error>
            <mat-label>{{'Select Business' | translate}}</mat-label>
            <mat-select formControlName="business_id" >
              <mat-select-trigger>

                    <span *ngIf="formAdInfo.controls.business_id.value">
                     <i class="fa fa-check-circle text-success"></i>&nbsp;{{formAdInfo.controls.business_id.value.business_name_prefix}} {{formAdInfo.controls.business_id.value.business_name}}
                    </span>

              </mat-select-trigger>
              <mat-option>
                <ngx-mat-select-search formControlName="search_business"
                                       placeholderLabel="{{'Search' | translate}} ..."
                                       noEntriesFoundLabel="'no match found'"></ngx-mat-select-search>
              </mat-option>

              <mat-option [value]="business" *ngFor="let business of businesses | searchBusiness : formAdInfo.controls.search_business.value">{{business.business_name_prefix}} {{business.business_name}}</mat-option>
            </mat-select>
          </mat-form-field>

        </div>
        <a class="text-primary text-right" [routerLink]="['/'+routes.business.create]"><i>{{"Don't have a business listed yet ? Create business" | translate}}</i></a>

      </div>


      <div class="row" >

        <mat-label>{{'Ad Title' | translate}}</mat-label>

        <div class="col-md-12">

          <mat-form-field    appearance="outline">
            <input formControlName="title"  name="ad_title" matInput>
            <mat-error>{{'What is ad title' | translate}}</mat-error>

          </mat-form-field>


        </div>
      </div>
      <div class="row">

        <div class="col-md-6">

          <mat-label>{{'Announcement Date' | translate}}</mat-label>
          <mat-form-field  appearance="outline">
            <mat-error>{{'When will the ad start ?' | translate}}</mat-error>

            <input matInput type="date" name="date" formControlName="date" >
          </mat-form-field>

        </div>

        <div class="col-md-6">

          <mat-label>{{'Announcement Status' | translate}}</mat-label>

          <div class="col-md-12">

            <mat-error *ngIf="formAdInfo.controls.status.touched && ! formAdInfo.controls.status.value">{{'Please specify' | translate}} </mat-error>

            <mat-slide-toggle formControlName="status"  name="status">{{'On / Off' | translate}}</mat-slide-toggle>

          </div>


        </div>




      </div>

      <div class="row mt-3">

        <mat-label matTooltip="{{'Example: Due to the increase in covid cases, we have once again implemented extreme biosecurity measures, so we only work with confirmed appointments 24 hours in advance.' | translate}}
">{{'Announcement Detail' | translate}}</mat-label>


        <div class="col-md-12">

          <mat-error *ngIf="formAdInfo.controls.description.touched && formAdInfo.controls.description.invalid ">{{'Description is required' | translate}}</mat-error>

          <ckeditor formControlName="description" name="description" [editor]="Editor"  data=""></ckeditor>



        </div>

      </div>
      <div class="row mt-5">

        <div class="col-md-12">
          <mat-label>{{'Images' | translate}}</mat-label>
          <div class="row" *ngIf="images.length > 0">
            <div class="col-md-3 mb-2" *ngFor="let img of images">
              <img src="{{img}}" class="img-fluid rounded mb-1">
              <br/>
              <button (click)="deleteImg(img)" class="btn btn-danger btn-block">
               <i class="fa fa-trash"></i> {{"Delete" | translate}}
              </button>
            </div>

          </div>
          <div class="col-md-12">
            <ngx-dropzone (change)="onSelect($event)">
              <ngx-dropzone-label>{{'Drop files here or click to upload' | translate}}</ngx-dropzone-label>

              <ngx-dropzone-image-preview  [file]="f" *ngFor="let f of files" [removable]="true" (removed)="onRemove(f)">
                <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
              </ngx-dropzone-image-preview>


            </ngx-dropzone>

          </div>



        </div>




      </div>
      <div class="row mt-3" *ngIf="fileProgress === true">

        <p class="text-primary">{{"Images uploading on progress" | translate}} ...</p>
        <mat-divider></mat-divider>
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>

      </div>


    </mat-card-content>
    <mat-divider></mat-divider>
    <mat-card-actions class="text-center">

      <div class="row">

        <div class="col-md-12 mt-2 mb-2 text-center" *ngIf="AdSaveProgress === true">
          <p class="text-success mb-2">
            {{'Saving Ad' | translate}} ...
          </p>
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </div>

        <div class="col-md-6">

        </div>
        <div class="col-md-6">
          <button *ngIf="AdSaveProgress === false"  class="next-btn" mat-raised-button color="primary">
            {{'Submit' | translate}}
          </button>
        </div>

      </div>




    </mat-card-actions>


  </mat-card>

</form>
