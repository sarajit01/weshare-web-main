
<div class="container-fluid pt-3 pb-5">

  <app-mobile-header-with-back-button [backUrl]="'/business/manage'" *ngIf="userAction === 'all' || userAction === 'time-slots'" [heading]="'Appointment Settings'"></app-mobile-header-with-back-button>


  <div class="row mb-5">


    <div class="col-12 mb-2 d-flex justify-content-between flex-wrap align-items-center">
      <h4 class="mb-0">{{"Business" | translate}}</h4>
      <h4 class="mb-0">
        {{business.business_name_prefix}} {{business.business_name}}
      </h4>
    </div>
    <div class="col-md-12 px-0">


      <mat-card>

        <mat-card-header>

          <mat-progress-bar mode="indeterminate" *ngIf="progress === true"></mat-progress-bar>
          <div class="w-100 mb-2">

            <div class="col-md-12 pb-2 px-0 d-flex justify-content-between align-items-center">

              <h4 class="fw-bold mb-0">
                {{"Appointment Schedule" | translate}}
              </h4>

              <div>
                <button *ngIf="formOpen === false" (click)="formOpen = true" class="btn btn-theme-dark btn-sm">
                  <i class="fa fa-plus"></i>&nbsp; {{"Add slot" | translate}}
                </button>
              </div>


            </div>

          </div>

        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-card-content class="px-0 p-md-4">

          <div class="row">

            <div class="col-md-12">



              <form class="my-2" id="promotion-form-mobile" *ngIf="formOpen === true" [formGroup]="addSlotForm" (submit)="saveAppointmentSettings()">

                <div class="row">

                  <div class="col-md-3">

                    <div class="form-group">

                      <label>Select days (check the boxes for the days you want to schedule the slot)</label>

                    </div>
                    <div class="w-100 my-3">
                      <div class="col-12" *ngFor="let day of days">
                        <mat-checkbox [checked]="day.checked" (change)="toggleDaySelection(day, $event)">{{day.day}}</mat-checkbox>
                      </div>

                    </div>

                  </div>
                  <div class="col-md-9">

                    <div class="row">

                      <div class="col-md-3">
                        <mat-form-field appearance="outline">
                          <mat-label>Service</mat-label>
                          <mat-select formControlName="service_id">
                            <mat-option value="">Select Service</mat-option>
                            <mat-option [value]="service.id" *ngFor="let service of business.services">{{service.service_name}}</mat-option>
                          </mat-select>

                        </mat-form-field>

                      </div>
                      <div class="col-md-3">

                        <mat-form-field appearance="outline">
                          <mat-label>Business User</mat-label>
                          <mat-select formControlName="business_user_id">
                            <mat-option value="">Select Business User</mat-option>
                            <mat-option value="{{user.user.id}}" *ngFor="let user of business.business_users">{{user.user.first_name}} {{user.user.last_name}}</mat-option>
                          </mat-select>

                        </mat-form-field>
                      </div>
                      <div class="col-md-3">

                        <mat-form-field appearance="outline">
                          <mat-label>{{"Duration for each appointment" | translate}}</mat-label>
                          <mat-select formControlName="duration">
                            <mat-option value="15">15 minutes</mat-option>
                            <mat-option value="30">30 minutes</mat-option>
                            <mat-option value="60">1 hour</mat-option>
                            <mat-option value="90">1.5 hours</mat-option>
                            <mat-option value="120">2 hours</mat-option>
                            <mat-option value="180">3 hours</mat-option>
                            <mat-option value="300">5 hours</mat-option>
                          </mat-select>
                        </mat-form-field>

                      </div>
                      <div class="col-md-3">
                        <mat-form-field appearance="outline">
                          <mat-label>
                            {{"Slot name" | translate}}
                          </mat-label>
                          <input matInput formControlName="slot_name" type="text" placeholder="Ex: 1st slot" >

                        </mat-form-field>
                      </div>
                      <div class="col-md-3">
                        <mat-form-field appearance="outline">
                          <mat-label>{{"Time starts" | translate}}</mat-label>
                          <input type="time" formControlName="starts_at" matInput>

                        </mat-form-field>
                      </div>
                      <div class="col-md-3">
                        <mat-form-field appearance="outline">
                          <mat-label>{{"Time ends" | translate}}</mat-label>
                          <input matInput type="time" formControlName="ends_at">

                        </mat-form-field>
                      </div>

                      <div class="col-md-3 d-flex justify-content-end gap-1 align-items-center">

                          <button class="btn btn-theme-dark " *ngIf="! addSlotForm.controls.id.value">
                            <i class="fa fa-plus"></i>&nbsp;  Add Slot
                          </button>&nbsp;
                          <button class="btn btn-theme-dark" *ngIf="addSlotForm.controls.id.value">
                            <i class="fa fa-refresh"></i>&nbsp;  Update
                          </button>&nbsp;
                          <button (click)="cancel()" class="btn btn-theme-dark">
                            Cancel
                          </button>&nbsp;

                      </div>

                    </div>

                  </div>


                </div>

              </form>


            </div>

            <div class="col-md-12 mt-1">

              <div class="w-100 d-none d-md-flex justify-content-between align-items-center pt-2 ">
                <h4 class="mb-0">Added time slots</h4>

              </div>

              <div class="w-100 d-md-none mt-2">
                <ng-container *ngIf="business && business.appointment_settings">
                  <ng-container *ngFor="let day of  business.appointment_settings">

                    <div class="card">
                      <div class="card-body py-0 px-0">
                          <div class="w-100 d-flex justify-content-between align-items-center">
                            <span *ngIf="day.business_user && day.business_user.user">{{day.business_user.user.username}}</span>
                            <span *ngIf="day.service">{{day.service.service_name}}</span>
                          </div>
                          <div class="w-100 d-flex gap-1">
                            <span>
                              {{day.day | translate}}
                            </span>
                            <span>
                              {{day.starts_at}} {{"to" | translate}} {{day.ends_at}}
                            </span>

                          </div>
                        <div class="w-100 d-flex align-items-center justify-content-between gap-1">
                          <div class="d-flex gap-1 align-items-center">
                              <span>
                              {{day.slot_name}}
                            </span>
                            <span>
                              {{day.duration}} {{"minutes" | translate}}
                            </span>

                          </div>
                          <div>
                            <span class="material-symbols-outlined cursor-pointer">
more_vert
</span>
                          </div>

                        </div>
                        <mat-divider class="my-2"></mat-divider>
                      </div>
                    </div>

                  </ng-container>
                </ng-container>
              </div>




              <div class="table-responsive d-none d-md-block">

                <table class="table table-hover">

                   <thead>
                   <tr>
                     <th>Service</th>
                     <th>Business user</th>
                     <th>Slot name</th>
                     <th>Day</th>
                     <th>Starts at</th>
                     <th>Ends at</th>
                     <th>Duration</th>
                     <th>
                      Edit
                     </th>
                     <th>Delete</th>
                   </tr>
                   </thead>
                  <tbody *ngIf="business && business.appointment_settings">

                   <tr *ngFor="let day of business.appointment_settings">
                     <td>
                       <span *ngIf="day.service">{{day.service.service_name}}</span>
                     </td>
                     <td>
                       <span *ngIf="day.business_user && day.business_user.user">{{day.business_user.user.username}}</span>
                     </td>
                     <td>
                       {{day.slot_name}}
                     </td>
                     <td>
                       {{day.day}}
                     </td>
                     <td>
                       {{day.starts_at}}
                     </td>
                     <td>
                       {{day.ends_at}}
                     </td>
                     <td>
                       {{day.duration}} minutes
                     </td>
                     <td>
                       <button (click)="editAppointmentSetting(day)" class="btn btn-primary btn-sm">
                         <i class="fa fa-edit"></i>
                       </button>
                     </td>
                     <td>
                       <button (click)="delete(day)" class="btn btn-danger btn-sm">
                         <i class="fa fa-trash"></i>
                       </button>
                     </td>
                   </tr>

                  </tbody>

                </table>

              </div>

              <div class="w-100" *ngIf="!business.appointment_settings || !business.appointment_settings.length">
                <div class="alert alert-dark my-3">
                  {{"No time slot added yet" | translate}}
                </div>
              </div>

            </div>

          </div>



        </mat-card-content>

      </mat-card>



    </div>
    <div class="col-md-12">




    </div>



  </div>







  <div class="row mt-5 mb-5">




    <footer style="height: 300px;margin-top: 100px;margin-bottom: 50px;">


      <div class="row">

        <div class="col-md-12">

          <p class="text-center">Guia en tu dispositivo movil
          </p>

        </div>
        <div class="col-md-12 mt-5 text-center">



          <button mat-raised-button class="btn-lg" color="primary">

            <i style="font-size: 25px;" class="fa fa-apple"></i>&nbsp; Get IOS App

          </button>&nbsp;&nbsp;
          <button mat-raised-button class="btn-lg" color="accent">

            <i style="font-size: 25px;" class="fa fa-android"></i>&nbsp; Get Android App

          </button>

          <br/>




        </div>
        <div class="col-md-12 mt-4 text-center">


          <hr/>
          <br/>
          <p>Sobre nosotros | Planes |  Para los negocios | Terminos del servicio | Politica de privacidad
          </p>

          <br/>
          <hr/>

          <mat-divider></mat-divider>

          <i style="font-size: 25px;color: #888" class="fa fa-facebook "></i>&nbsp;
          <i style="font-size: 25px;color: #888" class="fa fa-whatsapp"></i>&nbsp;
          <i style="font-size: 25px;color: #888" class="fa fa-instagram"></i>&nbsp;
          <i style="font-size: 25px;color: #888" class="fa fa-youtube "></i>&nbsp;
          <i style="font-size: 25px;color: #888" class="fa fa-twitter"></i>&nbsp;

          <br/><br/>
          <p>
            Derechos reservados 2021, IDS,  y marcas relacionadas son marcas registradas de IDS

          </p>





        </div>


      </div>



    </footer>


  </div>


</div>
