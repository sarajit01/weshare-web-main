<div class="row" (touchstart)="handleTouchStart($event)" (touchmove)="handleTouchMove($event)" *ngIf="business">

    <div   class="col-12 px-2 py-2 d-flex gap-2 justify-content-between align-items-center">
        <i (click)="closePopup()" class="fa fa-angle-down cursor-pointer"></i>

        <div  class="h-100 d-flex justify-content-center align-items-center">
            <h4 class="mb-0">
                <ng-container *ngIf="data.business && !data.loyalty_card">
                    {{business.name}}
                </ng-container>
                <ng-container *ngIf="data.loyalty_card">
                    {{data.loyalty_card.card_title}}
                </ng-container>


            </h4>
        </div>


        <i (click)="closePopup()" class="fa fa-times cursor-pointer"></i>
    </div>
    <mat-divider></mat-divider>

    <mat-progress-spinner *ngIf="progress"></mat-progress-spinner>


<!--    <div class="col-12 px-3 d-flex justify-content-between align-items-center mt-2 mb-2" *ngIf="user">-->
<!--        <div class="d-flex gap-2 align-items-center">-->
<!--            <mat-card style="width: 40px;height: 40px;border-radius: 50%!important;">-->
<!--                <mat-card-content class="w-100 h-100 d-flex justify-content-center align-items-center">-->
<!--                    <i class="fa fa-user text-primary"></i>-->
<!--                </mat-card-content>-->
<!--            </mat-card>-->
<!--            <h4 class="fw-bold mb-0">Hello {{user.first_name}}</h4>-->
<!--        </div>-->
<!--        <h4 class="mb-0 fw-bold text-primary">-->
<!--            {{user.points}} points-->
<!--        </h4>-->
<!--    </div>-->

    <div class="w-100 d-flex justify-content-between align-items-center pt-3 pb-3 px-5" *ngIf="! loyalty_card || loyalty_card.card_type !== 'prize'">
        <div class="d-flex flex-column justify-content-center align-items-center">
            <span class="fw-bold">{{user?.points ?? 0}}</span>
            <span>{{"Points" | translate}}</span>
        </div>
        <div class="d-flex flex-column justify-content-center align-items-center" *ngIf="data.loyalty_card">
           <span class="material-symbols-outlined text-success">
trophy
</span>
           <div>
               <span class="text-warning">L {{data.loyalty_card.point_value}} </span>
               <span class="text-success">
                   = 1 {{"Point" | translate}}
               </span>


           </div>
        </div>
    </div>

    <div class="w-100 d-flex mt-3">
        <ng-container *ngFor="let tab of tabs">
            <div class="w-50 tab-selector py-2" (click)="setActiveTab(tab)" [ngClass]="{'tab-active' : activeTab === tab}">
                <span>{{ tab | translate}}</span>
            </div>
        </ng-container>

<!--        <ng-container *ngIf="business || (data.loyalty_card && data.loyalty_card.card_type === 'point')">-->
<!--            <div class="w-50 tab-selector py-2" (click)="setActiveTab('transactions')" [ngClass]="{'tab-active' : activeTab === 'transactions'}">-->
<!--                <span>{{"My Transactions" | translate}}</span>-->
<!--            </div>-->
<!--        </ng-container>-->
<!--        <ng-container *ngIf="data.loyalty_card && data.loyalty_card.card_type === 'prize'">-->
<!--            <div class="w-50 tab-selector py-2" (click)="setActiveTab('visits')" [ngClass]="{'tab-active' : activeTab === 'visits'}">-->
<!--                <span>{{"My Visits" | translate}}</span>-->
<!--            </div>-->
<!--        </ng-container>-->

    </div>

    <div class="w-100 mt-2 pb-5" style="min-height: 80vh !important;">
        <ng-container *ngIf="activeTab === 'Prizes'">
            <h4 class="fw-bold">{{"Prizes" | translate}}</h4>

            <app-lc-prize [loyaltyCard]="loyalty_card"></app-lc-prize>

            <app-lcrewards-table [loyaltyCard]="loyalty_card" [customer]="user"></app-lcrewards-table>


        </ng-container>
        <ng-container  *ngIf="activeTab === 'My Transactions'">
            <h4 class="fw-bold">{{"My Transactions" | translate}}</h4>
            <ng-container *ngIf="rewards_history.length; else noRecord">
                <ng-container *ngFor="let reward of rewards_history" >
                    <div class="col-12 py-2 d-flex justify-content-between align-items-center">
                        <span>{{reward.created_at | date}}</span>

                        <div class="d-flex justify-content-center align-items-center">
                     <span class="fw-bold text-danger" *ngIf="reward.debit">
                -{{reward.debit}}
            </span>
                            <span class="fw-bold text-success" *ngIf="reward.credit">
                +{{reward.credit}}
            </span>
                        </div>

                        <div class="d-flex gap-2 align-items-center">
                         <span class="text-primary fw-bold">
                {{reward.balance}}
                         </span>
                            <i class="fa fa-angle-down" (click)="reward.expanded = true" *ngIf="!reward.expanded"></i>
                            <i class="fa fa-angle-up" (click)="reward.expanded = false" *ngIf="reward.expanded"></i>

                        </div>


                    </div>
                    <mat-divider *ngIf="reward.expanded">
                    </mat-divider>
                    <div class="col-12 py-2  align-items-center" *ngIf="reward.expanded">

                        <span>{{reward.details}}</span>

                    </div>

                    <mat-divider></mat-divider>

                </ng-container>

            </ng-container>

        </ng-container>

        <ng-container  *ngIf="activeTab === 'My Visits'">
            <h4 class="fw-bold">{{"My Visits" | translate}}</h4>
            <ng-container *ngIf="visits.length; else noRecord">
                <ng-container *ngFor="let visit of visits" >
                    <div class="col-12 py-2 d-flex justify-content-between align-items-center">
                        <span>{{visit.visited_at}}</span>


                        <div class="d-flex align-items-center" [class]="{'text-warning' : visit.status === 'Visited', 'text-danger' : visit.status === 'Ready to Reward' , 'text-success' : visit.status === 'Rewarded'}">

                            <span class="material-symbols-outlined" *ngIf="visit.status === 'Visited'">
directions_walk
</span>

                            <span class="material-symbols-outlined" *ngIf="visit.status === 'Ready to Reward'">
trophy
</span>

                                  <span class="material-symbols-outlined" *ngIf="visit.status === 'Rewarded'">
check_circle
</span>
                            {{visit.status}}
                        </div>

                    </div>

                    <mat-divider></mat-divider>

                </ng-container>

            </ng-container>

        </ng-container>

        <ng-template #noRecord>
            <div class="col-12">
                <div class="alert alert-danger">
                    {{"No record to show"}}
                </div>
            </div>

        </ng-template>

    </div>



</div>